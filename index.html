<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>We Hear You AI - Home</title>
    
    <!-- 
      ===============================================================
      == 1. ADDED SCRIPT TAGS FOR THE AI MODEL ==
      These are the TensorFlow.js libraries from your other file.
      They must be in the <head> to load before the page is used.
      ===============================================================
    -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>

    <style>
        body {
            font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
            font-size: 18px; /* Larger base font size for readability */
            line-height: 1.6;
            background-color: #f9f9f9; /* Soft, light background */
            color: #333; /* Dark grey text for high contrast */
            margin: 0;
            padding: 0;
        }

        .container {
            width: 90%;
            max-width: 900px; /* Limits width on very large screens */
            margin: 2rem auto; /* Centers the content */
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        header {
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2.8rem; /* Large, clear main title */
            color: #005a9c; /* A strong, professional blue */
            margin: 0;
        }

        header p {
            font-size: 1.3rem;
            color: #555;
            margin-top: 0.5rem;
        }

        main h2 {
            font-size: 2rem;
            color: #005a9c;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
        }

        main p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }

        .main-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .cta-button {
            display: block; /* Makes the link behave like a block */
            width: 80%;
            margin: 2rem auto; /* Centers the button */
            padding: 1.2rem 1.5rem;
            background-color: #007bff; /* Bright, accessible blue */
            color: #ffffff; /* White text for high contrast */
            font-size: 1.5rem; /* Very large text */
            font-weight: bold;
            text-align: center;
            text-decoration: none; /* Removes the underline */
            border-radius: 5px;
            transition: background-color 0.3s ease;
            /* Added for button element */
            border: none;
            cursor: pointer;
        }

        .cta-button:hover,
        .cta-button:focus {
            background-color: #0056b3; /* Darker blue on hover/focus */
            outline: 2px solid #004085; /* Accessibility for keyboard navigation */
        }
        
        /* ===============================================================
          == 2. ADDED STYLES FOR THE AI MODEL'S OUTPUT ==
          This will make the text results from the AI look clean.
          ===============================================================
        */
        #label-container {
            margin-top: 2rem;
            text-align: center;
        }

        #label-container div {
            font-size: 1.4rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background-color: #f4f4f4;
            border-radius: 5px;
        }


        footer {
            text-align: center;
            margin-top: 2rem;
            font-size: 0.9rem;
            color: #888;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Welcome to We Hear You AI</h1>
            <p>Your partner in clear communication.</p>
        </header>

        <main>
            <!-- SECTION 1: EMPOWERING YOU -->
            <h2>Empowering You with Simple AI</h2>
            <p>
                We are dedicated to helping you connect with your loved ones and the world around you. 
                Our tools are designed to be simple, effective, and easy to use, especially for 
                individuals who are elderly or hard of hearing.
            </p>

            <!-- SECTION 2: AI TOOL (MOVED TO MIDDLE) -->
            <h2>Try Our New AI Tool</h2>
            <p>
                Click the button below to access our AI assistant. It will ask for permission
                to use your microphone and start listening.
            </p>

            <!-- 
              ===============================================================
              == 3. MODIFIED THE BUTTON ==
              I changed this from an <a> link to a <button> element.
              I removed the 'href' and added an 'onclick="init()"'
              to start your JavaScript function.
              ===============================================================
            -->
            <button type="button" class="cta-button" onclick="init()">
                Start the AI Assistant
            </button>
            
            <!-- 
              ===============================================================
              == 4. ADDED THE 'label-container' DIV ==
              This is the empty <div> from your other file. The JavaScript
              will put the audio results (like "Clap: 0.98") inside here.
              ===============================================================
            -->
            <div id="label-container"></div>
            
            <!-- 
              ===============================================================
              == 5. MOVED THE IMAGE TO THE BOTTOM ==
              I also added a little bit of space above it with style="...".
              ===============================================================
            -->
            <img 
              src="https://www.helloglobo.com/hubfs/Literacy%20in%20the%20Deaf%20Community%20Blog%20Feature%20Image.svg" 
              alt="An illustration showing technology helping people communicate"
              class="main-image"
              style="margin-top: 2rem;"
            >
            
        </main>

        <footer>
            <p>&copy; 2025 We Hear You AI. All rights reserved.</p>
        </footer>
    </div>


    <!-- 
      ===============================================================
      == 6. ADDED YOUR AI JAVASCRIPT LOGIC ==
      This is the entire <script> block from your other file.
      It's best to put this at the very end of the <body>.
      ===============================================================
    -->
    <script type="text/javascript">
        // more documentation available at
        // https://github.com/tensorflow/tfjs-models/tree/master/speech-commands

        // the link to your model provided by Teachable Machine export panel
        const URL = "https://teachablemachine.withgoogle.com/models/glYc43z5X/";

        async function createModel() {
            const checkpointURL = URL + "model.json"; // model topology
            const metadataURL = URL + "metadata.json"; // model metadata

            const recognizer = speechCommands.create(
                "BROWSER_FFT", // fourier transform type, not useful to change
                undefined, // speech commands vocabulary feature, not useful for your models
                checkpointURL,
                metadataURL);

            // check that model and metadata are loaded via HTTPS requests.
            await recognizer.ensureModelLoaded();

            return recognizer;
        }

        async function init() {
            const recognizer = await createModel();
            const classLabels = recognizer.wordLabels(); // get class labels
            const labelContainer = document.getElementById("label-container");
            
            // Clear the container in case it's run more than once
            labelContainer.innerHTML = ""; 
            
            // Add a "Listening..." message
            labelContainer.innerHTML = "<div>Listening...</div>";

            for (let i = 0; i < classLabels.length; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }

            // listen() takes two arguments:
            // 1. A callback function that is invoked anytime a word is recognized.
            // 2. A configuration object with adjustable fields
            recognizer.listen(result => {
                const scores = result.scores; // probability of prediction for each class
                
                // Find the highest score
                let maxScore = 0;
                let maxIndex = 0;
                for (let i = 0; i < classLabels.length; i++) {
                    if (result.scores[i] > maxScore) {
                        maxScore = result.scores[i];
                        maxIndex = i;
                    }
                }

                // Clear the "Listening..." message
                labelContainer.innerHTML = "";
                
                // Render just the top prediction
                const classPrediction = classLabels[maxIndex] + ": " + maxScore.toFixed(2);
                labelContainer.innerHTML = `<div>${classPrediction}</div>`;
                
                // --- This is the old way (shows all scores) ---
                // render the probability scores per class
                // for (let i = 0; i < classLabels.length; i++) {
                //    const classPrediction = classLabels[i] + ": " + result.scores[i].toFixed(2);
                //    labelContainer.childNodes[i].innerHTML = classPrediction;
                // }
                // --- End of old way ---

            }, {
                includeSpectrogram: true, // in case listen should return result.spectrogram
                probabilityThreshold: 0.75,
                invokeCallbackOnNoiseAndUnknown: true,
                overlapFactor: 0.50 // probably want between 0.5 and 0.75. More info in README
            });

            // Stop the recognition in 5 seconds.
            // setTimeout(() => recognizer.stopListening(), 5000);
        }
    </script>

</body>
</html>
